(function(window){
var _private={};_private.crypto=window.crypto&&window.crypto.getRandomValues;_private.rng=function(a,b){var c,d;if(_private.crypto)c=new Uint32Array(a),window.crypto.getRandomValues(a);else for(c=[],d=a;d--;)c.push(~~(Math.random()*Math.pow(2,32))>>>0);if(b)for(;a--;)c[a]=c[a].toString(b);return c};
function Diffie(a){this.key=a.key||this.genSecret();if(this.common){var b=a.common.base;a=a.common.modulus;this.common={base:b instanceof BI?b:new BI(base),modulus:a instanceof BI?a:new BI(modulus)};this.genShared()}return this}Diffie.config={bits:{modulus:2048,base:224,secret:256}};Diffie.prototype.genSecret=function(){var a;a=Math.ceil(Diffie.config.bits.secret/32);_private.rng(a,16);return this.secret=new BI(a.join(""),16)};
Diffie.prototype.setCommon=function(a,b){Diffie.config.bits.modulus=b;Diffie.config.bits.base=a;this.genShared()};Diffie.prototype.genShared=function(){return this.shared=this.common.base.powmod(this.secret,this.common.modulus)};Diffie.prototype.updateShared=function(a){return a.powmod(this.secret,this.common.modulus)};
window.Diffie = Diffie;
})(window);